<!--This is a basic template for bootstrap, which links to the bootstrap stylesheet I modified it from this  http://getbootstrap.com/examples/starter-template/# -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <!--meta tags for FB and Twitter sharing-->
    <meta property="og:title" content="Barriers to Care"/>
    <meta property="og:url" content="https://lindsaymarie403.github.io/ACA-mental-health/index.html"/>
    <meta property="og:description" content="More people have access to mental health coverage, but they still can't see psychiatrists." />
    <meta property="og:image" content="http://lindsaymarie403.github.io/ACA-mental-health/IMG_4005_edit.jpg "/>

    <title>Barriers to Care</title>

    <!-- Bootstrap core CSS, which has been minified for faster load.  You can USE the styles in this stylesheet, but NEVER EDIT THIS FILE-->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <!--Put all of your custom styles in here.  Notice it comes below the core boostrap.min.css (core files). The order is important-->
     <link href="css/customstyles.css" rel="stylesheet">

     <!--Google fonts-->
     <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,700|PT+Serif" rel="stylesheet">

    <!-- These are special files that make all the fancy new stuff work in older versions of Internet Explorer-->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!--font awesome icons-->
    <script src="https://use.fontawesome.com/385a6bc5ff.js"></script>
  </head>

  <body data-spy="scroll" data-target=".navbar" data-offset="80">

    <div id="top-strip">
      <div id="page-tag"> After Obamacare: Health in Maryland</div>
    </div>

    <div id="hero-container">
      <img id="hero" src="IMG_4005_edit.jpg">
      <div id="hero-title">
        <div id="headline">Barriers to Care</div>
        <div id="subhead">More people have mental health coverage, but they still can't see psychiatrists</div>
      </div>
      <div id="photo-caption">MedStar Health employs 58 of Maryland's 1,154 psychiatrists. But finding one who takes your insurance is difficult. (Photo: Lindsay Huth)</div>
    </div>

    <nav class="navbar"><!--beginning of navbar-->
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav center-me">
            <li class="active"><a href="#">Top</a></li>
            <li><a href="#one">More Patients, Fewer Psychiatrists</a></li>
            <li><a href="#two">Search and Struggle</a></li>
            <li><a href="#three">'First to Be Shut Out'</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav><!--end of navbar-->


    <div class="container"> <!--beginning of main body section of document -->

      <!--byline-->
      <div class="row text-container">
        <div class="col-sm-8 col-sm-offset-2" id="story-top">
          <div class="col-sm-6" id="byline">
          By Lindsay Huth<span id="CNS"> for Capital News Service</span>
          </div>
          <div class="col-sm-6" id="share-story">
              <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//lindsaymarie403.github.io/ACA-mental-health/index.html" target="_blank"><i class="fa fa-facebook fa-lg icon" id="fb"aria-hidden="true"></i></a>
              <a href="https://twitter.com/home?status=More%20people%20have%20mental%20health%20coverage,%20but%20they%20cant%20see%20psychiatrists%3A%20https%3A//lindsaymarie403.github.io/ACA-mental-health/index.html" target="_blank"><i class="fa fa-twitter fa-lg icon" id="twitter" aria-hidden="true"></i></a>
          </div>
        </div>
      </div>

      <!--article section one-->
      <div class="row text-container">
        <div class="col-sm-8 col-sm-offset-2">
          <p><span id="dateline">COLLEGE PARK, Md. &mdash; </span>Celia Serkin’s daughter had just been released from psychiatric treatment in a hospital when she found herself back in a 24-hour crisis center.</p>
          <p>Her daughter needed medications to stay stable after release &mdash; but she couldn’t find an outpatient psychiatrist to treat her, Serkin said. The crisis center was the only option.</p>
          <p>“It doesn’t make sense to have a population that has insurance but can’t find care,” said Serkin, executive director of the Montgomery County Federation of Families for Children’s Mental Health.</p>
          <p>Over 200,000 people were added to the health insurance rolls in Maryland between 2013 and 2015, according to the U.S. Census bureau.</p>
          <p>The Affordable Care Act’s exchanges opened by 2014, and the law mandated that plans on the individual and small-group markets cover mental health services.</p>
          <p>But patients like Serkin’s daughter still have trouble seeing psychiatrists, who, doctors and advocates say, are overbooked, hard to find &mdash; and often not accepting insurance at all.</p>
          <br />
          <p><span class="section" id="one">More Patients, Fewer Psychiatrists</span></p>
          <p>Serkin’s family bought insurance on the Maryland Health Benefit Exchange, the state’s ACA-mandated insurance marketplace that began enrolling patients in October 2013.</p>
          <p>The ACA’s mandated mental health coverage built on the 2008 Mental Health Parity and Addiction Equity Act, which required plans that cover mental health services offer the same level of service &mdash; number of appointments, types of treatment &mdash; as they offer for other medical needs like diabetes or cancer.</p>
        </div>
      </div>
      <div id="chart-ne"></div>

      <!--chart one-->
      <div class="row chart-container">
        <div class="col-sm-10 col-sm-offset-1 chart-column">
          <div class="chart-title">
            Low-income people benefitted most from the ACA
          </div>
          <div class="chart-description">
            <p>The Affordable Care Act increased insurance coverage for all income levels, especially for those at and below 400 percent of the poverty threshold. Combined with mandated coverage for mental health benefits, this means that more people can theoretically get psychiatric care.</p>
          </div>
          <p class="chart-sub">Percent of Population with Health Insurance</p>
          <div id="chart-one"></div>
          <p class="chart-source">Source: U.S. Census Bureau</p>
        </div>
      </div>

      <!--article section two-->
      <div class="row text-container">
        <div class="col-sm-8 col-sm-offset-2">
          <p>But a limited number of psychiatrists &mdash; only 55 percent nationwide &mdash; accepted private insurance between 2009 and 2010, according to a study in the Journal of the American Medical Association Psychiatry, the most recent report on the issue.</p>
          <p>That number was lower than four years prior &mdash; and the lowest acceptance rate among all medical specialities studied.</p>
        </div>
      </div>

      <!--chart two-->
      <div class="row chart-container">
        <div class="col-sm-10 col-sm-offset-1 chart-column">
          <div class="chart-title">
            Nearly half of psychiatrists don't accept insurance
          </div>
          <div class="chart-description">
            <p>Nearly half of psychiatrists didn't accept private insurance in the years leading up to the ACA, the most recent years data are available. That number has trended downward and is a significant divergence from other medical specialties, making it particularly hard to see a psychiatrist.</p>
          </div>
          <p class="chart-sub">Percent of Physicians Accepting Insurance</p>
          <div id="chart-two"></div>
          <p class="chart-source">Source: JAMA Psychiatry</p>
        </div>
      </div>

      <!--article section three-->
      <div class="row text-container">
        <div class="col-sm-8 col-sm-offset-2">
          <p>“It seems psychiatrists have enough people who are willing to pay straight out of pocket to keep them in business, so they don’t feel they need to expand to insurance to make ends meet,” said Dr. Elias Shaya, senior associate executive director for behavioral health services at MedStar Health in Baltimore.</p>
          <p>Paying out of pocket isn’t possible for many of those newly insured under the ACA, as nearly half &mdash; 42 percent &mdash; had incomes less than 200 percent of the poverty threshold, according to U.S. Census Bureau data.</p>
          <p>And the consequences for not getting psychiatric care can be deadly, Shaya said.</p>
          <p>For patients with urges to hurt themselves or others, timely and regular care is essential for personal and public safety, Shaya said.</p>
          <p>For others, untreated psychiatric conditions prevent normal engagement in society, he said.</p>
          <p>“Their disease is such that their entire life is destroyed,” Shaya said. “It deals with the most essential part of our being &mdash; our brain, our ability to think, our ability to decide &mdash; and when that’s taken away, people can’t get jobs and end up on the streets.”</p>
          <br/>
          <p><span class="section" id="two">Search and Struggle</span></p>
          <p>Many patients like Serkin’s daughter need immediate care when transitioning from psychiatric hospital stays to outpatient services, relying on medication to keep them stable, said Adrienne Ellis, former director of the Maryland Parity Project, which helps people with difficulty finding mental health providers.</p>
          <p>Ellis said that during her tenure, the Parity Project fielded frequent calls from people on private insurance plans who were told they needed to wait four to six weeks for an appointment &mdash; often unreasonable given urgent mental distress.</p>
          <p>Ellis said many had called 10 to 15 providers, trying to find one who would even accept a new patient on their plan.</p>
          <p>A 2015 report from the Mental Health Association of Maryland confirms that finding a psychiatrist on a given insurance plan can be an onerous task.</p>
          <p>The organization studied the networks of psychiatrists for the four insurance carriers offering plans on the Maryland Health Connection, the website for Maryland’s health insurance marketplace.</p>
          <p>The carriers listed 1,154 psychiatrists total. Only 14 percent could be reached and were accepting new outpatients on the listed plan in the next 45 days.</p>
          <p>The information in the insurers’ directories are often wildly inaccurate, too: Less than half of the psychiatrists listed could be reached with the contact information given, and another 19 percent weren’t even psychiatrists, the Mental Health Association of Maryland found.</p>
        </div>
      </div>

      <!--chart three-->
      <div class="row chart-container">
        <div class="col-sm-10 col-sm-offset-1 chart-column">
          <div class="chart-title">
            Finding a psychiatrist accepting your insurance is difficult
          </div>
          <div class="chart-description">
            <p>Insurance companies don't update their network listings, meaning many psychiatrists listed are unreachable or not even psychiatrists. Others are not accepting the insurance listed or not taking new patients, making the task of making a psychiatric appointment onerous.</p>
          </div>
          <p class="chart-sub">Status of Psychiatrists Listed on Insurance Networks</p>
          <p class="chart-text">There are 1,154 psychiatrists listed on the networks of the insurers on the Maryland Health Connection. <br/>But when booking an appointment, how many options do patients really have?</p>
          <button type="button" class="btn btn-light btn-sm aca-button">Find My Options</button>
          <div id="chart-three"></div>
          <p class="chart-source">Source: Mental Health Association of Maryland</p>
        </div>
      </div>

      <!--article section four-->
      <div class="row text-container">
        <div class="col-sm-8 col-sm-offset-2">
          <p>“Insurance companies have the fiduciary responsibility when they take my premium to ensure I can get that treatment, that I can find someone who can give it,” Shaya said.</p>
          <p>By leaving their network listings inaccurate, Shaya said, the insurance companies can claim they are providing patients with sufficient options for finding a psychiatrist without actually doing so.</p>
          <p>Often, psychiatrists choose not to accept insurance because the reimbursement levels the companies provide are relatively low, said Dr. Kim Jones-Fearing, a psychiatrist in Columbia, Maryland.</p>
          <p>“Patients are not getting care and no one’s doing anything about it,” Jones-Fearing said.</p>
          <p>The state sought to rectify the inadequate networks by enacting a law last year that requires carriers to meet certain standards for the physician directories they provide.</p>
          <p>But Jones-Fearing and Shaya said there’s a shortage of psychiatrists in general, as psychiatry is already one of the lowest-paying medical specialties.</p>
          <br/>
          <p><span class="section" id="three">'First to Be Shut Out'</span></p>
          <p>The psychiatrists the state does have are concentrated in Montgomery, Howard and Baltimore Counties and Baltimore, according to the Maryland Board of Physicians’ roster.</p>
          <p>Those areas are generally more populated, but that leaves people in the counties with the largest increase in insured populations between 2013 and 2015 &mdash; like Wicomico and Prince George’s Counties &mdash; without care within a manageable distance.</p>
          <p>And Somerset County, which has the highest poverty rate in the state, according to the U.S. Census Bureau, has no psychiatrists at all.</p>
        </div>
      </div>

      <!--chart four-->
      <div class="row chart-container">
        <div class="col-sm-10 col-sm-offset-1 chart-column">
          <div class="chart-title">
            Few psychiatrists serve southern Maryland
          </div>
          <div class="chart-description">
            <p>Maryland's 1,271 psychiatrists are concentrated in urban areas, meaning many newly insured people would have to travel far to find a psychiatrist who's accepting their insurance or new patients. And Somerset County, which has the highest poverty rate in the state, has no psychiatrist.</p>
          </div>
          <div class="chart-header">Number of Insured People per Psychiatrist by County</div>
          <div class="chart-subtitle">Source: Maryland Board of Physicians and U.S. Census Bureau</div>
          <div id="chart-four">
            <iframe width="100%" height="520" frameborder="0" src="https://lindsaymarie403.carto.com/builder/a45d38b2-9961-43eb-a7e2-38f6f8e25629/embed" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
            <div id="legend">
              <div id="legend-title">Insured People Per Psychiatrist</div>
              <div class="legend-item">
                <div class="color-block-one"></div>
                <div class="color-title">50,000 &mdash; 14,000 people</div>
              </div>
              <div class="legend-item">
                <div class="color-block-two"></div>
                <div class="color-title">13,999 &mdash; 8,000 people</div>
              </div>
              <div class="legend-item">
                <div class="color-block-three"></div>
                <div class="color-title">7,999 &mdash; 6,000 people</div>
              </div>
              <div class="legend-item">
                <div class="color-block-four"></div>
                <div class="color-title">5,999 &mdash; 2,500 people</div>
              </div>
              <div class="legend-item">
                <div class="color-block-five"></div>
                <div class="color-title">Under 2,499 people</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!--article section five-->
      <div class="row text-container">
        <div class="col-sm-8 col-sm-offset-2">
          <p>The difficulty finding a nearby psychiatrist, or one who takes insurance or is accepting new patients, is particularly important for low-income people, as lower income is associated with higher levels of mental health issues, according to a study in the Journal of the American Medical Association Psychiatry.</p>
        </div>
      </div>

      <!--chart five-->
      <div class="row chart-container">
        <div class="col-sm-10 col-sm-offset-1 chart-column">
          <div class="chart-title">
            Low-income people are most likely to suffer from mental illness
          </div>
          <div class="chart-description">
            <p>The prevalence of major mental disorders increases as income level decrease, meaning poorer people are more likely to suffer from these issues. But poorer people are also less likely to be able to pay for psychiatric care out of pocket, should they not find a doctor on their insurance plan.</p>
          </div>
          <div class="chart-header">
            Prevalence of
            <select class="disorder">
              <option value="depression">Depression</option>
              <option value="anxiety">Generalized Anxiety</option>
              <option value="bipolar">Bipolar Disorder</option>
            </select>
            by Income Level
          </div>
          <div class="chart-subtitle">Source: JAMA Psychiatry</div>
          <div id="chart-five">
            <canvas id="chartfive"></canvas>
          </div>
        </div>
      </div>

      <!--article section six-->
      <div class="row text-container">
        <div class="col-sm-8 col-sm-offset-2">
          <p>Barbara Anderson encounters this issue daily as executive director of the Pro Bono Counseling Project in Maryland, a group that connects low-income people with mental health treatment.</p>
          <p>Anderson said more people who called Pro Bono in 2016 already had insurance than the year before &mdash; but the overall number of calls received, from people having trouble reaching psychiatrists or getting prescriptions, didn’t change.</p>
          <p>“The fact that the people who are least able to afford care are the first to be shut out &mdash; that creates its own stress,” Anderson said.</p>
          <p>Organizations like the Pro Bono Counseling Project and the Maryland Parity Project are working to connect needy patients with providers and educate people about their coverage rights.</p>
          <p>But when it comes to changing the climate for psychiatry in Maryland, Shaya suggests that responsibility falls to the insurance companies.</p>
          <p>A mechanism that continuously evaluates insurers’ networks -- and removes psychiatrists that haven’t accepted new patients in the last two months, for example -- would keep insurance companies accountable and incentivize them to recruit enough providers, Shaya said.</p>
          <p>“If you simplify things for psychiatrists and reimburse them at reasonable rate, psychiatrists will be interested,” Shaya said. “You just have to make it reasonable for them to make a living.”</p>

        </div>
      </div>

    </div><!-- /.container -->

    <!--footer-->
    <div id="footer">

      <div class="row container">
        <div class="col-sm-6 col-sm-offset-3" id="copyright">Copyright &copy; 2017 Lindsay Huth</div>
      </div>

    </div>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!--All of these links below make interactivity, which we'll add later, work. This-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <!--This is the core boostrap javascript file this is the original, but we need to correct the path-->
    <script src="js/bootstrap.min.js"></script>
    <!--highcharts js link-->
    <script src="charts/Highcharts-5.0.13/code/highcharts.js"></script>
    <!--chart.js link-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <!--d3 link-->
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <script>
    $(document).ready(function() {
      console.log($(window).scrollTop());
      if($(window).scrollTop() > 550) {
        $('nav').addClass('second-nav-fixed');
      }
      if($(window).scrollTop() < 551) {
        $('nav').removeClass('second-nav-fixed');
      }
    });
    </script>

    <!--this is a fake chart to make everything behave-->
    <!--<script>
    Highcharts.chart('chart-ne', {});
  </script>-->

    <!--chart one-->
    <script>
    // set the dimensions and margins of the graph
    var margin = {top: 20, right: 20, bottom: 40, left: 60},
        width = 500 - margin.left - margin.right,
        height = 300 - margin.top - margin.bottom;

    // set the ranges
    var x = d3.scaleLinear().range([0, width]);
    var y = d3.scaleLinear().range([height, 0]);

    // define the 1st line
    var valueline = d3.line()
        .x(function(d) { return x(d.date); })
        .y(function(d) { return y(d.alladults); });

    // define the 2nd line
    var valueline2 = d3.line()
        .x(function(d) { return x(d.date); })
        .y(function(d) { return y(d.lowincome); });

    // append the svg obgect to the body of the page
    // appends a 'group' element to 'svg'
    // moves the 'group' element to the top left margin
    var svg = d3.select("#chart-one").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .call(responsivefy)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

    // Get the data
    d3.csv("chart1.csv", function(error, data) {
      if (error) throw error;

      // format the data
      data.forEach(function(d) {
          d.date = +d.date;
          d.alladults = +d.alladults;
          d.lowincome = +d.lowincome;
      });

      // Scale the range of the data
      x.domain([2012.8, 2015.2]);
      y.domain([.78, .94]);

      // Add the valueline path.
      svg.append("path")
          .data([data])
          .attr("class", "line")
          .style("stroke", "#bcbcbc")
          .style("stroke-width", "3px")
          .attr("d", valueline);

      // Add the valueline2 path.
      svg.append("path")
          .data([data])
          .attr("class", "line")
          .style("stroke", "#7cc0c9")
          .style("stroke-width", "3px")
          .attr("d", valueline2);

      // Add the X Axis
      svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .style("font-family", "'PT Sans'")
          .call(d3.axisBottom(x).tickFormat(d3.format("d")).ticks(3));

      // text label for the x axis
      svg.append("text")
          .attr("transform",
                "translate(" + (width/2) + " ," +
                               (height + margin.top + 15) + ")")
          .style("text-anchor", "middle")
          .text("Year")
          .attr("font-size", "12px");

      // Add the Y Axis
      svg.append("g")
        .style("font-family", "'PT Sans'")
          .call(d3.axisLeft(y).tickFormat(d3.format(".0%")));

      // text label for the y axis
      svg.append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 0 - margin.left)
          .attr("x",0 - (height / 2))
          .attr("dy", "1em")
          .style("text-anchor", "middle")
          .text("Percent of Adults with Insurance")
          .attr("font-size", "12px");

      // Append a circle for each datapoint on valueline
      svg.selectAll(".dot1")
          .data(data)
        .enter().append("circle") // Uses the enter().append() method
          .attr("class", "dot1") // Assign a class for styling
          .attr("cx", function(d) { return x(d.date); })
          .attr("cy", function(d) { return y(d.alladults); })
          .attr("r", 4)
          .style("fill", "#bcbcbc");

      // Append a circle for each datapoint on valueline2
      svg.selectAll(".dot2")
          .data(data)
        .enter().append("circle") // Uses the enter().append() method
          .attr("class", "dot2") // Assign a class for styling
          .attr("cx", function(d) { return x(d.date); })
          .attr("cy", function(d) { return y(d.lowincome); })
          .attr("r", 4)
          .style("fill", "#7cc0c9");

      // formatter
      var f = d3.format(".1%")

      // Append data labels to valueline
      svg.selectAll(".text1")
          .data(data)
        .enter().append("text")
          .attr("x", function(d) { return x(d.date) - 15; })
          .attr("y", function(d) { return y(d.alladults) - 10; })
          .text( function (d) { return f(d.alladults); })
          .attr("font-size", "10px");

      // Append data labels to valueline2
      svg.selectAll(".text2")
          .data(data)
        .enter().append("text")
          .attr("x", function(d) { return x(d.date) - 15; })
          .attr("y", function(d) { return y(d.lowincome) - 10; })
          .text(function (d) { return f(d.lowincome); })
          .attr("font-size", "10px");

      // Append line title to valueline
      svg.selectAll(".text3")
          .data(data)
        .enter().append("text")
          .attr("x", function(d) { return x(d.date); })
          .attr("y", function(d) { return y(d.alladults) + 18; })
          .text("All Adults")
          .attr("font-size", "10px")
          .style("display", function(d) {
             var disp;
             if (d.date === 2013) { disp = "inline";
           } else { disp = "none";
             } return disp;
           });

      // Append line title to valueline2
      svg.selectAll(".text4")
          .data(data)
        .enter().append("text")
          .attr("x", function(d) { return x(d.date); })
          .attr("y", function(d) { return y(d.lowincome) + 18; })
          .text("Adults at or below 400% of poverty threshold")
          .attr("font-size", "10px")
          .style("display", function(d) {
             var disp;
             if (d.date === 2013) { disp = "inline";
           } else { disp = "none";
             } return disp;
           });

    });

    function responsivefy(svg) {
      // get container + svg aspect ratio
      var container = d3.select(svg.node().parentNode),
          width = parseInt(svg.style("width")),
          height = parseInt(svg.style("height")),
          aspect = width / height;

      // add viewBox and preserveAspectRatio properties,
      // and call resize so that svg resizes on inital page load
      svg.attr("viewBox", "0 0 " + width + " " + height)
          .attr("preserveAspectRatio", "xMinYMid")
          .call(resize);

      // to register multiple listeners for same event type,
      // you need to add namespace, i.e., 'click.foo'
      // necessary if you call invoke this function for multiple svgs
      // api docs: https://github.com/mbostock/d3/wiki/Selections#on
      d3.select(window).on("resize." + container.attr("id"), resize);

      // get width of container and resize svg to fit it
      function resize() {
          var targetWidth = parseInt(container.style("width"));
          svg.attr("width", targetWidth);
          svg.attr("height", Math.round(targetWidth / aspect));
      }
    }

  </script>

  <!--chart two-->
  <script>
  // set the dimensions and margins of the graph
  var margin3 = {top: 20, right: 20, bottom: 40, left: 60},
      width3 = 500 - margin3.left - margin3.right,
      height3 = 300 - margin3.top - margin3.bottom;

  // set the ranges
  var x3 = d3.scaleLinear().range([0, width3]);
  var y3 = d3.scaleLinear().range([height3, 0]);

  // define the 1st line
  var valueline3 = d3.line()
      .x(function(d) { return x3(d.date); })
      .y(function(d) { return y3(d.psychiatrists); });

  // define the 2nd line
  var valueline4 = d3.line()
      .x(function(d) { return x3(d.date); })
      .y(function(d) { return y3(d.other); });

  // append the svg obgect to the body3 of the page
  // appends a 'group' element to 'svg'
  // moves the 'group' element to the top left margin3
  var svg3 = d3.select("#chart-two").append("svg")
      .attr("width", width3 + margin3.left + margin3.right)
      .attr("height", height3 + margin3.top + margin3.bottom)
      .call(responsivefy3)
    .append("g")
      .attr("transform",
            "translate(" + margin3.left + "," + margin3.top + ")");

  // Get the data
  d3.csv("chart2.csv", function(error, data) {
    if (error) throw error;

    // format the data
    data.forEach(function(d) {
        d.date = +d.date;
        d.psy3chiatrists = +d.psy3chiatrists;
        d.other = +d.other;
    });

    // Scale the range of the data
    x3.domain([2004.5, 2009.5]);
    y3.domain([0, 1]);

    // Add the valueline3 path.
    svg3.append("path")
        .data([data])
        .attr("class", "line")
        .style("stroke", "#7cc0c9")
        .style("stroke-width", "3px")
        .attr("d", valueline3);

    // Add the valueline4 path.
    svg3.append("path")
        .data([data])
        .attr("class", "line")
        .style("stroke", "#bcbcbc")
        .style("stroke-width", "3px")
        .attr("d", valueline4);

    // Add the x Axis
    svg3.append("g")
        .attr("transform", "translate(0," + height3 + ")")
        .style("font-family", "'PT Sans'")
        .call(d3.axisBottom(x3).tickValues([2005,2009]).tickFormat(d3.format("d")).ticks(5));

    // text label for the x axis
    svg3.append("text")
        .attr("transform",
              "translate(" + (width3/2) + " ," +
                             (height3 + margin3.top + 15) + ")")
        .style("text-anchor", "middle")
        .text("Year")
        .attr("font-size", "12px");

    // Add the y Axis
    svg3.append("g")
      .style("font-family", "'PT Sans'")
        .call(d3.axisLeft(y3).tickFormat(d3.format(".0%")).ticks(5));

    // text label for the y axis
    svg3.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 0 - margin3.left)
        .attr("x",0 - (height3 / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Percent of Physicians Insurance")
        .attr("font-size", "12px");

    // Append a circle for each datapoint on valueline3
    svg3.selectAll(".dot1")
        .data(data)
      .enter().append("circle") // Uses the enter().append() method
        .attr("class", "dot1") // Assign a class for sty3ling
        .attr("cx", function(d) { return x3(d.date); })
        .attr("cy", function(d) { return y3(d.psychiatrists); })
        .attr("r", 4)
        .style("fill", "#7cc0c9");

    // Append a circle for each datapoint on valueline4
    svg3.selectAll(".dot2")
        .data(data)
      .enter().append("circle") // Uses the enter().append() method
        .attr("class", "dot2") // Assign a class for sty3ling
        .attr("cx", function(d) { return x3(d.date); })
        .attr("cy", function(d) { return y3(d.other); })
        .attr("r", 4)
        .style("fill", "#bcbcbc");

    // formatter
    var f3 = d3.format(".1%")

    // Append data labels to valueline3
    svg3.selectAll(".text1")
        .data(data)
      .enter().append("text")
        .attr("x", function(d) { return x3(d.date) - 15; })
        .attr("y", function(d) { return y3(d.psychiatrists) - 10; })
        .text( function (d) { return f3(d.psychiatrists); })
        .attr("font-size", "10px");

    // Append data labels to valueline4
    svg3.selectAll(".text2")
        .data(data)
      .enter().append("text")
        .attr("x", function(d) { return x3(d.date) - 15; })
        .attr("y", function(d) { return y3(d.other) - 10; })
        .text(function (d) { return f3(d.other); })
        .attr("font-size", "10px");

    // Append line title to valueline
    svg3.selectAll(".text3")
        .data(data)
      .enter().append("text")
        .attr("x", function(d) { return x3(d.date); })
        .attr("y", function(d) { return y3(d.psychiatrists) + 18; })
        .text("Psychiatrists")
        .attr("font-size", "10px")
        .style("display", function(d) {
           var disp;
           if (d.date === 2005) { disp = "inline";
         } else { disp = "none";
           } return disp;
         });

    // Append line title to valueline2
    svg3.selectAll(".text4")
        .data(data)
      .enter().append("text")
        .attr("x", function(d) { return x3(d.date); })
        .attr("y", function(d) { return y3(d.other) + 18; })
        .text("Other Physicians")
        .attr("font-size", "10px")
        .style("display", function(d) {
           var disp;
           if (d.date === 2005) { disp = "inline";
         } else { disp = "none";
           } return disp;
         });

  });

  function responsivefy3(svg) {
    // get container + svg aspect ratio
    var container = d3.select(svg.node().parentNode),
        width3 = parseInt(svg.style("width")),
        height3 = parseInt(svg.style("height")),
        aspect = width3 / height3;

    // add viewBox and preserveAspectRatio properties,
    // and call resize so that svg resizes on inital page load
    svg.attr("viewBox", "0 0 " + width3 + " " + height3)
        .attr("preserveAspectRatio", "xMinYMid")
        .call(resize);

    // to register multiple listeners for same event type,
    // you need to add namespace, i.e., 'click.foo'
    // necessary if you call invoke this function for multiple svgs
    // api docs: https://github.com/mbostock/d3/wiki/Selections#on
    d3.select(window).on("resize." + container.attr("id"), resize);

    // get width of container and resize svg to fit it
    function resize() {
        var targetWidth = parseInt(container.style("width"));
        svg.attr("width", targetWidth);
        svg.attr("height", Math.round(targetWidth / aspect));
    }
  }

  </script>


  <!--chart three-->
  <script>
  // set the dimensions and margins of the graph
  var margin4 = {top: 30, right: 20, bottom: 20, left: 20},
      width4 = 500 - margin4.left - margin4.right,
      height4 = 230 - margin4.top - margin4.bottom;

  var svg4 = d3.select("#chart-three").append("svg")
      .attr("width", width4 + margin4.left + margin4.right)
      .attr("height", height4 + margin4.top + margin4.bottom)
      .call(responsivefy3)
    .append("g")
      .attr("transform",
            "translate(" + margin4.left + "," + margin4.top + ")");

  // set the ranges
  var x4 = d3.scaleLinear().range([0, width4]);
  var y4 = d3.scaleLinear().range([height4, 0]);

  svg4.append("text")
      .attr("transform",
            "translate(-5,-10)")
      .style("font-size", "8px")
      .style("font-weight", "700")
      .attr("fill", "#8e8e8e")
      .text("Unreachable");

  var svg5 = d3.select('svg4')
     .append('svg')
     .attr('width', 200)
     .attr('height', 200);

  var line = d3.line()
     .x(function(d) {
       return d.x;
     })
     .y(function(d) {
       return d.y;
     });

  var points = [{
       x: -5, y: -5 //top left
     },{
       x: 257, y: -5 //top right
     },{
       x: 257, y: 185 //bottom right
     },{
       x: -5, y: 185 //bottom left
     }];

  svg4.append('path')
   .attr("d", line(points) + 'Z')
   .attr("fill", "#d3d3d3")
   .style("stroke", "#8e8e8e")
   .style("opacity", 0.3);

  // Get the data
  d3.csv("chart3.csv", function(error, data) {
    if (error) throw error;

    // format the data
    data.forEach(function(d) {
        d.coorx = +d.coorx;
        d.coory = +d.coory;
    });

    // Scale the range of the data
    x4.domain([1, 420]);
    y4.domain([1, 211]);

    // Append a circle for each datapoint on valueline3
    svg4.selectAll(".dot4")
        .data(data)
      .enter().append("circle") // Uses the enter().append() method
        .attr("class", "dot4") // Assign a class for sty3ling
        .attr("cx", function(d) { return x4(d.coorx); })
        .attr("cy", function(d) { return y4(d.coory); })
        .attr("r", 2)
        .style("fill", "#7cc0c9");


    // formatter
    var f3 = d3.format(".1%")

  });

  function responsivefy3(svg) {
    // get container + svg aspect ratio
    var container = d3.select(svg.node().parentNode),
        width4 = parseInt(svg.style("width")),
        height4 = parseInt(svg.style("height")),
        aspect = width4 / height4;

    // add viewBox and preserveAspectRatio properties,
    // and call resize so that svg resizes on inital page load
    svg.attr("viewBox", "0 0 " + width4 + " " + height4)
        .attr("preserveAspectRatio", "xMinYMid")
        .call(resize);

    // to register multiple listeners for same event type,
    // you need to add namespace, i.e., 'click.foo'
    // necessary if you call invoke this function for multiple svgs
    // api docs: https://github.com/mbostock/d3/wiki/Selections#on
    d3.select(window).on("resize." + container.attr("id"), resize);

    // get width of container and resize svg to fit it
    function resize() {
        var targetWidth = parseInt(container.style("width"));
        svg.attr("width", targetWidth);
        svg.attr("height", Math.round(targetWidth / aspect));
    }
  }

  </script>

  <!--old chart three
  <script>
      Highcharts.chart('chart-three', {
        chart: {
            type: 'bar'
        },
        title: {
            text: 'Status of Psychiatrists Listed on Insurance Networks'
        },
        subtitle: {
            text: 'Source: Mental Health Association of Maryland'
        },
        credits: {
            enabled: false
        },
        xAxis: {
            categories: ['']
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Percent of Psychiatrists Listed'
            },
            labels: {
              format: '{value}%',
            }
        },
        legend: {
            reversed: true,
            itemDistance: 30,
            itemMarginBottom: 10,
            itemStyle: {
              fontSize: '13px',
              fontWeight: 'normal',
            }
        },
        plotOptions: {
            series: {
                stacking: 'percent',
                dataLabels: {
                    enabled: true,
                    format: '{y} percent'
                },
            }
        },
        series: [{
            name: 'Accepting New Patients in Next 45 Days',
            data: [13.5],
            color: '#7cc0c9'
        }, {
            name: 'Unavailable or Not Taking Insurance',
            data: [29.5],
            color: '#859091'
        }, {
            name: 'Unreachable',
            data: [56.9],
            color: '#e8e8e8'
        }]
    });
  </script>
-->

  <!--chart five-->
  <script>
  Chart.defaults.global.legend.display = false;
  var ctx = document.getElementById('chartfive').getContext('2d');
  var chart = new Chart(ctx, {
    // The type of chart we want to create
    type: 'bar',

    // The data for our dataset
    data: {
        labels: ['Less than $20,000', '$20,000 - 39,999', '$40,000 - 69,999', 'Over $70,000'],
        datasets: [{
            backgroundColor: '#7cc0c9',
            borderColor: 'rgb(255, 99, 132)',
            data: [27.1, 21.9, 21.1, 19.4],
        }]
    },

    // Configuration options go here
    options: {
      scales: {
        xAxes: [{
          scaleLabel: {
            display: true,
            labelString: 'Income Level',
            fontFamily: "'PT Sans', sans-serif",
            fontSize: 16,
          },
          ticks: {
            fontSize: 14,
            fontFamily: "'PT Sans', sans-serif",
          }
        }],
        yAxes: [{
          scaleLabel: {
            display: true,
            labelString: 'Percent Diagnosed with Disorder',
            fontFamily: "'PT Sans', sans-serif",
            fontSize: 16,
          },
          ticks: {
            fontSize: 14,
            fontFamily: "'PT Sans', sans-serif",
            min: 0,
            max: 30,
            callback: function(label, index, labels) {
              return label+'%';
            }
          }
        }],
      },
      tooltips: {
        enabled: true
      },
      maintainAspectRatio: false,
    }
  });

  // thanks to stackoverflow user rhill for this solution
  $('.disorder').change(function () {
          var sel = $(this).val();
          var newData = [];
          switch(sel) {
            case 'anxiety':
              newData = [10.3, 7.9, 7.3, 6.2];
              chart.data.datasets[0].data.length = 0;
              chart.data.datasets[0].data.push.apply(
              chart.data.datasets[0].data, newData);
              break;
            case 'bipolar':
              newData = [10.1, 8.3, 6, 4.7];
              chart.data.datasets[0].data.length = 0;
              chart.data.datasets[0].data.push.apply(
              chart.data.datasets[0].data, newData);
              break;
            case 'depression':
              newData = [27.1, 21.9, 21.1, 19.4];
              chart.data.datasets[0].data.length = 0;
              chart.data.datasets[0].data.push.apply(
              chart.data.datasets[0].data, newData);
              break;
          }
          chart.update();
        });
  </script>

  <!--scroll spy for nav-->
  <script>
    $('body').scrollspy({ target: '.navbar', offset: 80 })
  </script>

  </body>
</html>
